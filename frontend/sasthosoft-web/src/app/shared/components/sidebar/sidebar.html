<div class="sidebar">
  <!-- Search Section -->
  <div class="search-container">
    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <input 
        matInput 
        placeholder="Search menu..." 
        [(ngModel)]="searchQuery"
        (ngModelChange)="filterMenu()"
      >
      <button 
        *ngIf="searchQuery" 
        matSuffix 
        mat-icon-button 
        aria-label="Clear"
        (click)="clearSearch()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <!-- Menu Items -->
  <div class="menu-container">
    <ng-container *ngFor="let item of filteredMenuItems">
      <!-- Parent Item with Children -->
      <mat-expansion-panel 
        *ngIf="item.children?.length" 
        class="menu-panel"
        [expanded]="item.expanded"
        hideToggle
      >
        <mat-expansion-panel-header class="menu-header">
          <mat-panel-title class="menu-title">
            <mat-icon class="menu-icon">{{item.icon}}</mat-icon>
            <span class="menu-label">{{item.label}}</span>
            <mat-icon class="expand-icon">expand_more</mat-icon>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <!-- Child Items -->
        <div class="child-menu">
          <ng-container *ngFor="let child of item.children">
            <!-- Child with Grandchildren -->
            <mat-expansion-panel 
              *ngIf="child.children?.length" 
              class="menu-panel child-panel"
              [expanded]="child.expanded"
              hideToggle
            >
              <mat-expansion-panel-header class="menu-header child-header">
                <mat-panel-title class="menu-title">
                  <mat-icon class="menu-icon sub-icon">{{child.icon}}</mat-icon>
                  <span class="menu-label">{{child.label}}</span>
                  <mat-icon class="expand-icon">expand_more</mat-icon>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <!-- Grandchild Items -->
              <div class="grandchild-menu">
                <a 
                  *ngFor="let grandchild of child.children"
                  class="menu-link grandchild-link"
                  [routerLink]="grandchild.route"
                  routerLinkActive="active"
                  (click)="onMenuItemClick(grandchild)"
                >
                  <span class="bullet"></span>
                  <span class="menu-label">{{grandchild.label}}</span>
                </a>
              </div>
            </mat-expansion-panel>

            <!-- Direct Child Link -->
            <a 
              *ngIf="!child.children?.length"
              class="menu-link child-link"
              [routerLink]="child.route"
              routerLinkActive="active"
              (click)="onMenuItemClick(child)"
            >
              <mat-icon class="menu-icon">{{child.icon || 'fiber_manual_record'}}</mat-icon>
              <span class="menu-label">{{child.label}}</span>
            </a>
          </ng-container>
        </div>
      </mat-expansion-panel>

      <!-- Direct Parent Link (No Children) -->
      <a 
        *ngIf="!item.children?.length"
        class="menu-link parent-link"
        [routerLink]="item.route"
        routerLinkActive="active"
        (click)="onMenuItemClick(item)"
      >
        <mat-icon class="menu-icon">{{item.icon}}</mat-icon>
        <span class="menu-label">{{item.label}}</span>
      </a>
    </ng-container>

    <!-- No Results Message -->
    <div *ngIf="filteredMenuItems.length === 0" class="no-results">
      <mat-icon>search_off</mat-icon>
      <span>No menu items found</span>
    </div>
  </div>
</div>